<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Exemplo de Par√¢metros</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        #titulo {
            margin: 0 0 20px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            text-align: center;
        }
        
        #powerbi-iframe {
            border: 2px solid #ddd;
            border-radius: 5px;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
    <body>
        <h1 id="titulo">Esprerando...</h1>
        
        <!-- Bot√µes para testar os cliques -->
        <div style="margin-bottom: 20px; text-align: center;">
            <button onclick="clicarElementoPowerBI('[aria-label=`id_empreendimento`]')" style="margin: 5px; padding: 10px 20px; background-color: #007acc; color: white; border: none; border-radius: 5px; cursor: pointer;">
                Clicar Filtro
            </button>
            <button onclick="clicarElementoPowerBI('grafico')" style="margin: 5px; padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                Clicar Gr√°fico
            </button>
            <button onclick="clicarElementoPowerBI('botao-direito')" style="margin: 5px; padding: 10px 20px; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">
                Clicar Direita
            </button>
            <button onclick="automacaoCliques()" style="margin: 5px; padding: 10px 20px; background-color: #6f42c1; color: white; border: none; border-radius: 5px; cursor: pointer;">
                Automa√ß√£o
            </button>
        </div>
        
        <!-- Bot√µes para controlar o rastreamento do mouse -->
        <div style="margin-bottom: 20px; text-align: center;">
            <button onclick="iniciarRastreamentoMouse()" style="margin: 5px; padding: 8px 16px; background-color: #17a2b8; color: white; border: none; border-radius: 3px; cursor: pointer;">
                üñ±Ô∏è Iniciar Rastreamento
            </button>
            <button onclick="pararRastreamentoMouse()" style="margin: 5px; padding: 8px 16px; background-color: #6c757d; color: white; border: none; border-radius: 3px; cursor: pointer;">
                ‚èπÔ∏è Parar Rastreamento
            </button>
            <button onclick="console.clear()" style="margin: 5px; padding: 8px 16px; background-color: #ffc107; color: black; border: none; border-radius: 3px; cursor: pointer;">
                üßπ Limpar Console
            </button>
        </div>
        
        <div style="margin-bottom: 10px; text-align: center; font-size: 12px; color: #666;">
            <strong>Atalhos:</strong> Ctrl+1 (Filtro) | Ctrl+2 (Gr√°fico) | Ctrl+3 (Direita) | Ctrl+0 (Automa√ß√£o) | <strong>Ctrl+M (Toggle Mouse)</strong>
        </div>
        <script>
        // Captura os par√¢metros da URL
        const urlParams = new URLSearchParams(window.location.search);
        const id_empreendimento = urlParams.get('id_empreendimento');

        // Usa os par√¢metros dinamicamente
        document.getElementById('titulo').textContent = `id_empreendimento: ${id_empreendimento}`;

        // Fun√ß√£o para ajustar o iframe para tela cheia
        function ajustarIframeTelaCheio() {
            const iframe = document.getElementById('powerbi-iframe');
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            // Ajusta as dimens√µes do iframe para ocupar toda a tela
            iframe.width = screenWidth;
            iframe.height = screenHeight - 100; // Subtrai 100px para deixar espa√ßo para o t√≠tulo
            
            console.log(`Dimens√µes da tela: ${screenWidth}x${screenHeight}`);
            console.log(`Iframe ajustado para: ${iframe.width}x${iframe.height}`);
        }

        // Executa quando a p√°gina carrega
        window.addEventListener('load', ajustarIframeTelaCheio);
        
        // Reajusta quando a janela √© redimensionada
        window.addEventListener('resize', ajustarIframeTelaCheio);

        // Fun√ß√£o para fazer cliques no Power BI (contorna o cross-origin)
        function clicarNoPowerBI(x, y) {
            const iframe = document.getElementById('powerbi-iframe');
            
            // Cria um evento de clique simulado
            const clickEvent = new MouseEvent('click', {
                view: window,
                bubbles: true,
                cancelable: true,
                clientX: x,
                clientY: y
            });
            
            // Simula o clique no iframe
            iframe.dispatchEvent(clickEvent);
            console.log(`Clique simulado em: x=${x}, y=${y}`);
        }
        
        // Fun√ß√£o para clicar em posi√ß√µes espec√≠ficas do Power BI
        function clicarElementoPowerBI(posicao) {
            const iframe = document.getElementById('powerbi-iframe');
            const rect = iframe.getBoundingClientRect();
            
            let x, y;
            
            switch(posicao) {
                case 'filtro':
                    x = rect.left + 50;  // Posi√ß√£o aproximada do filtro
                    y = rect.top;
                    break;
                case 'grafico':
                    x = rect.left + rect.width / 2;  // Centro do gr√°fico
                    y = rect.top + rect.height / 2;
                    break;
                case 'botao-direito':
                    x = rect.left + rect.width - 100;  // Lado direito
                    y = rect.top + 50;
                    break;
                default:
                    x = rect.left + 100;
                    y = rect.top + 100;
            }
            
            // Foca no iframe primeiro
            iframe.focus();
            
            // Simula o clique
            setTimeout(() => {
                clicarNoPowerBI(x, y);
            }, 100);
        }
        
        // Fun√ß√£o para automatizar cliques sequenciais
        function automacaoCliques() {
            console.log('Iniciando automa√ß√£o de cliques...');
            
            // Clique 1: Filtro (ap√≥s 2 segundos)
            setTimeout(() => {
                clicarElementoPowerBI('filtro');
            }, 2000);
            
            // Clique 2: Gr√°fico (ap√≥s 4 segundos)
            setTimeout(() => {
                clicarElementoPowerBI('grafico');
            }, 4000);
            
            // Clique 3: Bot√£o direito (ap√≥s 6 segundos)
            setTimeout(() => {
                clicarElementoPowerBI('botao-direito');
            }, 6000);
        }
        
        // Adiciona teclas de atalho para facilitar os testes
        document.addEventListener('keydown', (event) => {
            if (event.ctrlKey) {
                switch(event.key) {
                    case '1':
                        event.preventDefault();
                        clicarElementoPowerBI('filtro');
                        break;
                    case '2':
                        event.preventDefault();
                        clicarElementoPowerBI('grafico');
                        break;
                    case '3':
                        event.preventDefault();
                        clicarElementoPowerBI('botao-direito');
                        break;
                    case '0':
                        event.preventDefault();
                        automacaoCliques();
                        break;
                }
            }
        });
        
        // Script para mostrar posi√ß√£o do mouse no console
        let mouseTracking = false;
        
        function iniciarRastreamentoMouse() {
            mouseTracking = true;
            console.log('üñ±Ô∏è Rastreamento do mouse INICIADO');
            console.log('Pressione Ctrl+M para parar o rastreamento');
        }
        
        function pararRastreamentoMouse() {
            mouseTracking = false;
            console.log('üñ±Ô∏è Rastreamento do mouse PARADO');
        }
        
        // Evento para capturar movimento do mouse
        document.addEventListener('mousemove', (event) => {
            if (mouseTracking) {
                const x = event.clientX;
                const y = event.clientY;
                console.log(`üñ±Ô∏è Mouse: x=${x}, y=${y}`);
                
                // Verifica se o mouse est√° sobre o iframe
                const iframe = document.getElementById('powerbi-iframe');
                const rect = iframe.getBoundingClientRect();
                
                if (x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom) {
                    const relativeX = x - rect.left;
                    const relativeY = y - rect.top;
                    console.log(`üìä Posi√ß√£o relativa no Power BI: x=${relativeX}, y=${relativeY}`);
                }
            }
        });
        
        // Evento para capturar cliques e mostrar coordenadas
        document.addEventListener('click', (event) => {
            if (mouseTracking) {
                const x = event.clientX;
                const y = event.clientY;
                console.log(`üéØ CLIQUE em: x=${x}, y=${y}`);
                
                // Verifica se o clique foi no iframe
                const iframe = document.getElementById('powerbi-iframe');
                const rect = iframe.getBoundingClientRect();
                
                if (x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom) {
                    const relativeX = x - rect.left;
                    const relativeY = y - rect.top;
                    console.log(`üéØ CLIQUE no Power BI: x=${relativeX}, y=${relativeY}`);
                    console.log(`üí° Para usar: clicarNoPowerBI(${x}, ${y})`);
                }
            }
        });
        
        // Adiciona atalho para controlar o rastreamento
        document.addEventListener('keydown', (event) => {
            if (event.ctrlKey && event.key === 'm') {
                event.preventDefault();
                if (mouseTracking) {
                    pararRastreamentoMouse();
                } else {
                    iniciarRastreamentoMouse();
                }
            }
        });
        
        // Inicia o rastreamento automaticamente
        window.addEventListener('load', () => {
            setTimeout(() => {
                iniciarRastreamentoMouse();
            }, 1000);
        });
        
        // Voc√™ pode fazer muito mais aqui:
        // - carregar um gr√°fico
        // - disparar uma requisi√ß√£o fetch
        // - gerar um link para Power BI com filtros aplicados
        </script>
        <iframe 
            id="powerbi-iframe"
            title="Resumo Carteira PELT -  GEO - Corredores e Prioriza√ß√£o - 2.0" 
            width="600" 
            height="373.5" 
            src="https://app.powerbi.com/view?r=eyJrIjoiN2RmNTdlYWItOWJjMi00YjE2LThhZjYtZDhmZmNlM2Y4YTI4IiwidCI6ImZjNWJlNzgyLWM2MTktNGM2Ni05M2ExLWExNmNiMjNjMzhmOSJ9&pageName=4ed15a60a7e9c1b03cb0" 
            frameborder="0" 
            allowFullScreen="true">
        </iframe>
    </body>
</html>
